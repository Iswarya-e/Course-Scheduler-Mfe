<div *ngIf="loading$ | async" class="text-center my-4">
  <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Loading students...</span>
  </div>
</div>

<div *ngIf="error$ | async as error" class="alert alert-danger my-3" role="alert">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  {{ error.message || error }}
</div>

<div *ngIf="(students$ | async)?.length; else noStudents" class="table-responsive">
  <table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>S.No</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
        <th>Contact</th>
        <th>Grade</th>
        <th>School Name</th>
        <th>Courses</th> <!-- New column -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let student of students$ | async; index as i">
        <td>{{ i + 1 }}</td>
        <td>{{ student.studentDetail.firstName }}</td>
        <td>{{ student.studentDetail.lastName }}</td>
        <td>{{ student.email }}</td>
        <td>{{ student.studentDetail.contactNo }}</td>
        <td>{{ student.studentDetail.grade }}</td>
        <td>{{ student.studentDetail.schoolName }}</td>
        <td>
        <ng-container *ngIf="editingRowIndex !== i; else editTemplate">
          <ul class="list-inline mb-0">
            <li *ngFor="let course of student.courses" class="list-inline-item badge bg-primary me-1">
              {{ course.title }}
            </li>
          </ul>
          <button class="btn btn-sm btn-outline-primary mt-1" (click)="startEdit(i, student)">Edit</button>
        </ng-container>

        <ng-template #editTemplate>
          <div class="mb-2">
            <!-- Display selected courses as badges -->
            <span *ngFor="let course of editedCourses" class="badge bg-info text-dark me-1">
              {{ course.title }}
              <button type="button" class="btn-close btn-close-white btn-sm ms-1" (click)="removeCourse(course)"></button>
            </span>
          </div>

    <!-- Autocomplete-like select -->
        <input
          class="form-control form-control-sm mb-2"
          type="text"
          placeholder="Search course..."
          [(ngModel)]="courseInput"
          (input)="filterCourses()"
        />

        <div *ngIf="filteredCourses.length" class="border p-2 rounded bg-white shadow-sm">
          <div
            *ngFor="let course of filteredCourses"
            class="dropdown-item"
            (click)="addCourse(course)"
            style="cursor: pointer;"
          >
            {{ course.title }}
          </div>
        </div>

    <button class="btn btn-sm btn-success me-1 mt-2" (click)="saveEdit(student)">Save</button>
    <button class="btn btn-sm btn-secondary mt-2" (click)="cancelEdit()">Cancel</button>
  </ng-template>
</td>

      </tr>
    </tbody>
  </table>
</div>

<ng-template #noStudents>
  <div class="alert alert-info text-center my-4">
    <i class="bi bi-info-circle-fill me-2"></i>
    No students found.
  </div>
</ng-template>
